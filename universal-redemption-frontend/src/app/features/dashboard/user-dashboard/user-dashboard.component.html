<div class="dashboard-layout">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="user-card">
      <div class="avatar">{{ userInitials }}</div>
      <div class="user-info">
        <h4>{{ userName }}</h4>
        <p>{{ userEmail }}</p>
      </div>
    </div>

    <nav class="menu">
      <a [class.active]="currentSection==='dashboard'" (click)="setSection('dashboard')">Dashboard</a>
      <a [class.active]="currentSection==='redeem'" (click)="setSection('redeem')">Redeem Cash</a>
      <a>Send Money</a>
      <a>Transaction History</a>
      <a (click)="logout()" class="logout">Logout</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="content">

    <header class="page-header">
      <h2>{{ currentSection === 'dashboard' ? 'Dashboard' : 'Redeem Cash Send' }}</h2>
      <span class="sub">{{ currentSection === 'dashboard' ? 'Overview of your wallet activity' : 'Enter Cash Send
        details to redeem funds' }}</span>
    </header>

    <!-- Wallet Card -->
    <section class="wallet-section">
      <div class="wallet-card">
        <p class="label">Wallet Balance</p>
        <h1>R {{ balance | number:'1.2-2' }}</h1>
        <span class="hint">Available funds</span>
      </div>
    </section>

    <!-- Dashboard Section -->
    <section *ngIf="currentSection === 'dashboard'" class="transactions-section">
      <h3>Recent Transactions</h3>

      <div class="table-wrapper" *ngIf="transactions.length">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Reference</th>
              <th>Type</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let t of transactions">
              <td>{{ t.createdAt | date:'short' }}</td>
              <td>{{ t.reference }}</td>
              <td>{{ t.type }}</td>
              <td [class.credit]="t.isCredit" [class.debit]="!t.isCredit">
                {{ t.isCredit ? '+' : '-' }}R{{ t.amount }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <p *ngIf="!transactions.length && !loading" class="empty">
        No transactions yet
      </p>

      <!-- Pagination -->
      <div class="pagination">
        <button (click)="prevPage()" [disabled]="page === 1">Prev</button>
        <span>Page {{ page }}</span>
        <button (click)="nextPage()" [disabled]="page * pageSize >= total">Next</button>
      </div>
    </section>

    <!-- Redeem Cash Section -->
    <section *ngIf="currentSection === 'redeem'" class="redeem-section">

      <div class="wallet-card redeem-card">
        <h3 class="redeem-title">Redeem Cash Send</h3>
        <p class="redeem-subtitle">
          Enter your Cash Send details to deposit funds into your wallet
        </p>

        <form (ngSubmit)="redeemCash()" #redeemForm="ngForm">

          <!-- Provider -->
          <div class="floating-group">
            <select id="provider" name="provider" [(ngModel)]="redeemDto.provider" required>
              <option value="" disabled selected hidden></option>

              <option value="FNB_EWALLET">FNB eWallet</option>
              <option value="CAPITEC_CASH_SEND">Capitec Cash Send</option>
              <option value="NEDBANK_SENDIMALI">Nedbank SendiMali</option>
              <option value="STANDARD_BANK_IM">Standard Bank Instant Money</option>
            </select>

            <label for="provider">Provider</label>
          </div>


          <!-- Reference Number -->
          <div class="floating-group">
            <input type="text" id="referenceNumber" name="referenceNumber" [(ngModel)]="redeemDto.referenceNumber"
              required placeholder=" " />
            <label for="referenceNumber">Reference Number</label>
          </div>

          <!-- PIN -->
          <div class="floating-group">
            <input type="password" id="pin" name="pin" [(ngModel)]="redeemDto.pin" required placeholder=" " />
            <label for="pin">PIN</label>
          </div>

          <button type="submit" class="redeem-btn" [disabled]="redeemForm.invalid || loading">
            {{ loading ? 'Redeemingâ€¦' : 'Redeem Funds' }}
          </button>
        </form>

        <div *ngIf="message" class="redeem-message" [class.success]="success" [class.error]="!success">
          {{ message }}
        </div>
      </div>

    </section>

  </main>
</div>

<app-footer></app-footer>